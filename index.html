<!DOCTYPE html>
<head>
  <style>
    body{
    color:#000000;
    margin-left:0;
    margin-right:0;
    margin-top:0;
    margin-bottom:0;
    margin-width:0;
    margin-height:0;
    padding: 5px;
}


input:invalid {
  border-color: rgb(197, 3, 3);
}
input:valid {
  border-color: rgb(36, 175, 36);
}

.generate_Button{
  text-align: center;
  height: 100px;
  width: 100px;
  padding: 0;
}
.styled-table {
    border-collapse: collapse;

    font-size: 0.9em;
    font-family: sans-serif;
    width:100%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
}

.styled-table thead tr {
    background-color: #009879;
    color: #ffffff;
    text-align: left;
}

.styled-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

.styled-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3;
}

.styled-table tbody tr:last-of-type {
    border-bottom: 2px solid #009879;
}

.styled-main-table {
    margin-top: -20px;
    border-collapse: collapse;
    font-size: 0.9em;
    font-family: sans-serif;
    width:100%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
}

.styled-main-table thead tr {
    background-color: #009879;
    color: #ffffff;
    text-align: left;
}

.styled-main-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

.styled-main-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3;
}

.styled-main-table tbody tr:last-of-type {
    border-bottom: 2px solid #009879;
}

.styled-main-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

body:before{
  content:'';
  height:100%;
  display:inline-block;
  vertical-align:middle;
}
button{
  background:#1AAB8A;
  color:#fff;
  border:none;
  position:relative;
  height:20px;
  font-size:1em;
  padding:0 2em;
  cursor:pointer;
  transition:800ms ease all;
  outline:none;
}
button:hover{
  background:#fff;
  color:#1AAB8A;
}
button:before,button:after{
  content:'';
  position:absolute;
  top:0;
  right:0;
  height:2px;
  width:0;
  background: #1AAB8A;
  transition:400ms ease all;
}
button:after{
  right:inherit;
  top:inherit;
  left:0;
  bottom:0;
}
button:hover:before,button:hover:after{
  width:100%;
  transition:800ms ease all;
}
  </style>
<script>
  window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
  window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction || {READ_WRITE: "readwrite"}; 
  window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;

  if (!window.indexedDB) {
    window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");
  }

  function init(){
    var request = window.indexedDB.open("ClientDatabase", 1);
    request.onerror = function(event) {
      alert("Error faced while opening database");
    };
    request.onsuccess = function(event) {
      db = event.target.result;
      db.onerror = function(event) {
        alert("Database error: " + event.target.errorCode);
      };
      updatetable();
  };
  function randomText(textArray) {
    var randomIndex = Math.floor(Math.random() * textArray.length); 
    var randomElement = textArray[randomIndex];
    return randomElement;
  }
  const upperCase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  document.getElementById('generateButton').onclick = function(e){
    document.getElementById("nameInput").value = randomText(['Michał', 'Ola', 'Jola', 'Zofia', 'Kacper', 'Helena', 'Jakub', 'Bartek']);
    document.getElementById("surnameInput").value = randomText(['Brot', 'Tracz', 'Bąk', 'Grzelak', 'Nowak']);
    document.getElementById("emailInput").value = Math.random().toString(36).substring(2, 5) + Math.random().toString(36).substring(2, 5) + Math.random().toString(36).substring(2, 5) + randomText(['@gmail.com', '@hotmail.com', '@wp.pl']);
    document.getElementById("addressInput").value = randomText(['ul. Piotrkowska', 'ul. Dobra', 'ul. Rokocinska', 'ul. Warszawska']);
    document.getElementById("cityInput").value = randomText(['Łódź', 'Warszawa', 'Gdynia', 'Poznań']);
    document.getElementById("postalInput").value = (Math.floor(Math.random() * 89 + 10) + '-' + Math.floor(Math.random() * 899 + 100)).toString(); 
    document.getElementById("companyInput").value = randomText(['Erikpol', 'Firmoplex', 'Pazurex', 'Polbruk', 'Kodpol']);
    document.getElementById("phoneInput").value = Math.floor(Math.random() * 899 + 100).toString() + Math.floor(Math.random() * 899 + 100).toString() + Math.floor(Math.random() * 899 + 100).toString(); 
    document.getElementById("nipInput").value = Math.floor(Math.random() * 899 + 100).toString() + '-' + Math.floor(Math.random() * 899 + 100).toString() + '-' + Math.floor(Math.random() * 89 + 10).toString() + '-' + Math.floor(Math.random() * 89 + 10).toString();
    document.getElementById("idCardInput").value = upperCase[Math.floor(Math.random() * upperCase.length)] + upperCase[Math.floor(Math.random() * upperCase.length)] + upperCase[Math.floor(Math.random() * upperCase.length)] + Math.floor(Math.random() * 899999 + 100000).toString();
  }

  document.getElementById('deleteBaseButton').onclick = function(e){
    var req = indexedDB.deleteDatabase('ClientDatabase');
req.onsuccess = function () {
    console.log("Deleted database successfully");
};
req.onerror = function () {
    console.log("Couldn't delete database");
};
req.onblocked = function () {
    console.log("Couldn't delete database due to the operation being blocked");
};
window.location.reload();
  }

  request.onupgradeneeded = function(event) {  
    var db = event.target.result;
    var objectStore = db.createObjectStore("clients", {keyPath: "id", autoIncrement: true});
    objectStore.createIndex("name", "name", {unique: false});
    objectStore.createIndex("surname", "surname", {unique: false});
    objectStore.createIndex("email", "email", {unique: false});
    objectStore.createIndex("address", "address", {unique: false});
    objectStore.createIndex("city", "city", {unique: false});
    objectStore.createIndex("postal", "postal", {unique: false});
    objectStore.createIndex("nip", "nip", {unique: false});
    objectStore.createIndex("company", "company", {unique: false});
    objectStore.createIndex("id_card", "id_card", {unique: false});
    objectStore.createIndex("phone", "phone", {unique: false});
    objectStore.transaction.oncomplete = function(event) {
      
    };
  };

  document.getElementById('addClientForm').onsubmit = function(e) {
    e.preventDefault();

    var bname = document.getElementById('nameInput').value;
    var bsurname = document.getElementById('surnameInput').value;
    var bemail = document.getElementById('emailInput').value;
    var baddress = document.getElementById('addressInput').value;
    var bcity = document.getElementById('cityInput').value;
    var bpostal = document.getElementById('postalInput').value;
    var bnip = document.getElementById('nipInput').value;
    var bcompany = document.getElementById('companyInput').value;
    var bid_card = document.getElementById('idCardInput').value;
    var bphone = document.getElementById('phoneInput').value;

    if (!bname || !bsurname || !bemail || !baddress || !bcity || !bpostal || !bphone) {
      window.alert("Fill the form correctly!");
      return;
    }

    const book_item = {
      name: bname,
      surname: bsurname,
      email: bemail,
      address: baddress, 
      city: bcity, 
      postal: bpostal,
      nip: bnip,
      company: bcompany,
      id_card: bid_card,
      phone: bphone
    }
    var transaction = db.transaction(["clients"], "readwrite");
    transaction.oncomplete = function(event) {
      console.log("all done with transaction");
    };
    transaction.onerror = function(event){
      console.dir(event);
    };
    var clientsObjectStore = transaction.objectStore("clients");
    var request = clientsObjectStore.add(book_item);
    request.onsuccess = function(event){
      console.log("added item");
    };

    updatetable();

  }

  function inputFilter(e) {
    var filter = document.getElementById('filterInput').value;
    if (!filter) {
      filter = "";
    }
    filter = filter.toLowerCase();
    
    document.getElementById("clients-table-body").innerHTML = "";
    var request = db.transaction("clients").objectStore("clients").openCursor();
    request.onerror = function(event){
      console.dir(event);
    };
    request.onsuccess = function(event){
      cursor = event.target.result;

      if(cursor) {
        if 
          ((cursor.key.toString().localeCompare(filter) == 0 ||
          cursor.value.name.toLowerCase().includes(filter) || 
          cursor.value.surname.toLowerCase().includes(filter) || 
          cursor.value.email.toLowerCase().includes(filter) || 
          cursor.value.address.toLowerCase().includes(filter) || 
          cursor.value.city.toLowerCase().includes(filter) || 
          cursor.value.postal.toLowerCase().includes(filter) || 
          cursor.value.nip.toLowerCase().includes(filter) || 
          cursor.value.company.toLowerCase().includes(filter) || 
          cursor.value.id_card.toLowerCase().includes(filter) || 
          cursor.value.phone.toLowerCase().includes(filter)
        )) {
          document.getElementById("clients-table-body").innerHTML += "<tr><td>" + cursor.key + 
            "</td><td>" + cursor.value.name 
              + "</td><td>" + cursor.value.surname
              + "</td><td>" + cursor.value.email
              + "</td><td>" + cursor.value.address
              + "</td><td>" + cursor.value.city 
              + "</td><td>" + cursor.value.postal
              + "</td><td>" + cursor.value.nip
              + "</td><td>" + cursor.value.company 
              + "</td><td>" + cursor.value.id_card
              + "</td><td>" + cursor.value.phone
              + "</td><td><button id=\"delButton\"  style=\"background:#ff2f2f\" value=\"" + cursor.key + "\">Usun</button>"
              + "</td></tr>";
              document.getElementById('delButton').onclick = function(e){
                var id_del = parseInt(document.getElementById('delButton').value);
                var request = db.transaction(["clients"], "readwrite").objectStore("clients").delete(id_del);
                document.getElementById('filterInput').value = "";
                updatetable();
              }
          }
        try {
          cursor.continue();
        } catch (Exception) {}
      }
    };
  } document.getElementById('filterInput').addEventListener("input", inputFilter);

  function updatetable(){
    document.getElementById("clients-table-body").innerHTML = "";
    var request = db.transaction("clients").objectStore("clients").openCursor();
    request.onerror = function(event){
      console.dir(event);
    };
    request.onsuccess = function(event){
      cursor = event.target.result;

      if (cursor) {
        document.getElementById("clients-table-body").innerHTML += "<tr><td>" + cursor.key + 
          "</td><td>" + cursor.value.name 
            + "</td><span contenteditable='true'></span><td>" + cursor.value.surname
            + "</td><td>" + cursor.value.email
            + "</td><td>" + cursor.value.address
            + "</td><td>" + cursor.value.city 
            + "</td><td>" + cursor.value.postal
            + "</td><td>" + cursor.value.nip
            + "</td><td>" + cursor.value.company 
            + "</td><td>" + cursor.value.id_card
            + "</td><td>" + cursor.value.phone
            + "</td><td><button id=\"delButton\"  style=\"background:#ff2f2f\" value=\"" + cursor.key + "\">Usun</button>"
            + "</td></tr>";
            document.getElementById('delButton').onclick = function(e){
              var id_del = parseInt(document.getElementById('delButton').value);
              var request = db.transaction(["clients"], "readwrite").objectStore("clients").delete(id_del);
              document.getElementById('filterInput').value = "";
              updatetable();
           }
          }
          try {
          cursor.continue();
        } catch (Exception) {}
      }
    };
  }



</script>
</head>

<body onload="init()">

  <table class="styled-main-table">
    <thead>
      <tr>
          <th>Generuj</th><th>Form</th>
      </tr>
      </thead>
    <tr>
      <th>
        <button id="generateButton" class="generate_Button">Generuj</button>
      </th>
      <th style="text-align:left">
        <p>
          <form id="addClientForm">
            <fieldset id="addForm">
              <legend>Dodawanie</legend>
    
              <label>Podaj ID elementu, który chcesz edytować</label>
              <input id="idInput">
    
              <table class="styled-table">
                <tr>
                  <th>
                    <label>Imie</label>
                    <input id="nameInput" placeholder="Imie" required="true">
                  </th>
                  <th>
                    <label>Nazwisko</label>
                    <input id="surnameInput" placeholder="Nazwisko" required="true">
                  </th>
                  <th>
                    <label for="email">Email</label>
                    <input id="emailInput" type="email" id="email" name="email" placeholder="example@email.com" required="true">
                  </th>
                  <th>
                    <label for="phoneNumber">Tel.</label>
                    <input type="text" id="phoneInput" placeholder="123123123" name="phone_number" pattern="[0-9]{9}" maxlength="9" required="true">
                  </th>
                </tr>
                <tr>
                  <th>
                    <label for="cityInput">Miasto</label>
                    <input id="cityInput" placeholder="Miasto" required="true"> 
                  </th>
                  <th>
                    <label for="postalCode">Kod pocztowy</label>
                    <input type="text" id="postalInput" name="postal_code" placeholder="11-111" pattern="\d{2}-\d{3}"  maxlength="6" required="true">
                  </th>
                  <th>
                    <label for="idCard">nr. dowodu</label>
                    <input type="text" id="idCardInput" name="id_card" placeholder="ABC123456" pattern="[A-Z a-z]{3}[0-9]{6}"  maxlength="9" required="true">
                  </th>
                  <th></th>
                </tr>
                <tr>
                  <th>
                    <label for="nipNumber">NIP</label>
                    <input type="text" id="nipInput" name="nip_number" placeholder="123-456-78-90" pattern="((\d{3}[- ]\d{3}[- ]\d{2}[- ]\d{2})|(\d{3}[- ]\d{2}[- ]\d{2}[- ]\d{3}))" title="Numer NIP" maxlength="13" required="true">
                  </th>
                  <th>
                    <label for="companyName">Nazwa Firmy</label>
                    <input id="companyInput" placeholder="firmopol" required="true">
                  </th>
                  <th><label for="address">Adres</label>
                    <input type="text" id="addressInput" placeholder="ulica + numer" required="true"></th><th></th>
                </tr>
              </table>
  
              
              
              <button type="submit" id="addButton" style="width:100%">Dodaj</button>
              
    
            </fieldset>
          </form>
          
        </p>
      </th>
    </tr>
  </table>
  
      <p>
        <fieldset id="searchForm">
          <legend>Wyszukiwanie</legend>
          <table style="width:100%;">
            <tr>
              <th>
                <input id="filterInput" placeholder="Wyszukaj..."style="width:70%;">
              </th>

              <th>
                <button id="deleteBaseButton" style="background:#ff2f2f;">usun baze</button>
              </th>
            </tr>
          </table>
  
        </fieldset>
      </p>
      
      <table id="clients-table" class="styled-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Imie</th>
              <th>Nazwisko</th>
              <th>Email</th>
              <th>Adres</th>
              <th>Miasto</th>
              <th>Kod pocztowy</th>
              <th>NIP</th>
              <th>Firma</th>
              <th>nr. dowodu</th>
              <th>tel.</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="clients-table-body">
          </tbody>
      </table>
      
  </body>
</html>